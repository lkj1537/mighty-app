<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mighty Master</title>
    <script src="config.js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #f3f4f6; -webkit-tap-highlight-color: transparent; font-family: 'Pretendard', sans-serif; }
        .menu-card { transition: all 0.2s; border: 1px solid #e5e7eb; }
        .menu-card:active { transform: scale(0.95); background-color: #f9fafb; }
        [v-cloak] { display: none; }
        
        /* ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¸°ê¸° */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>
    <div id="app" v-cloak class="max-w-4xl mx-auto min-h-screen bg-white shadow-xl flex flex-col">
        
        <header class="bg-gray-900 text-white py-5 px-4 text-center shadow-lg">
            <h1 class="text-xl font-black italic tracking-tighter">MIGHTY MASTER</h1>
        </header>

        <main class="flex-grow p-6">
            
            <section v-if="step === 1" class="h-full flex flex-col justify-center space-y-4 pt-10">
                <div class="text-center mb-10">
                    <p class="text-gray-400 text-sm font-bold uppercase tracking-widest">Welcome back</p>
                    <h2 class="text-3xl font-black text-gray-800">ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?</h2>
                </div>
                
                <button @click="step = 2" class="menu-card w-full p-8 rounded-[2rem] bg-white shadow-sm flex items-center justify-between group">
                    <div class="text-left">
                        <h3 class="text-xl font-black text-gray-800">ê²Œì„ ì‹œì‘</h3>
                        <p class="text-sm text-gray-400">ì¸ì› ì„ íƒ ë° ë¹„ë”© ê¸°ë¡</p>
                    </div>
                    <span class="text-3xl">ğŸƒ</span>
                </button>

                <button @click="alert('í†µê³„ ê¸°ëŠ¥ì€ ë°ì´í„°ê°€ ìŒ“ì¸ í›„ ì˜¤í”ˆë©ë‹ˆë‹¤!')" class="menu-card w-full p-8 rounded-[2rem] bg-white shadow-sm flex items-center justify-between opacity-60">
                    <div class="text-left">
                        <h3 class="text-xl font-black text-gray-800">ì „ì  í†µê³„</h3>
                        <p class="text-sm text-gray-400">ELO ë­í‚¹ ë° ìŠ¹ë¥  í™•ì¸</p>
                    </div>
                    <span class="text-3xl">ğŸ“Š</span>
                </button>
            </section>

            <section v-if="step === 2" class="space-y-6">
                <button @click="step = 1" class="text-sm text-gray-400 font-bold">â† í™ˆìœ¼ë¡œ</button>
                <div class="flex justify-between items-end">
                    <h2 class="text-2xl font-black text-gray-800">ì¸ì› ì„ íƒ</h2>
                    <span class="text-blue-600 font-black">{{ selectedPlayers.length }} / 5 ëª…</span>
                </div>
                
                <div class="grid grid-cols-2 gap-3 max-h-[45vh] overflow-y-auto p-1">
                    <button v-for="name in playerList" :key="name" 
                        @click="togglePlayer(name)"
                        :class="['p-4 rounded-2xl border-2 font-bold transition-all', 
                                 selectedPlayers.includes(name) ? 'border-blue-600 bg-blue-50 text-blue-700' : 'border-gray-100 bg-white text-gray-400']">
                        {{ name }}
                    </button>
                </div>

                <div class="bg-gray-100 p-3 rounded-2xl flex gap-2">
                    <input v-model="newPlayerName" @keyup.enter="addPlayer" class="flex-grow bg-transparent px-3 text-sm outline-none" placeholder="ì‹ ê·œ ë©¤ë²„ ì¶”ê°€...">
                    <button @click="addPlayer" class="bg-white px-4 py-2 rounded-xl text-xs font-black shadow-sm">ë“±ë¡</button>
                </div>

                <button @click="step = 3" :disabled="selectedPlayers.length !== 5"
                    class="w-full py-5 bg-blue-600 text-white rounded-[2rem] font-black text-lg shadow-xl disabled:bg-gray-200 transition-colors">
                    ì¸ì› ì„ íƒ ì™„ë£Œ
                </button>
            </section>

            <section v-if="step === 3" class="space-y-6">
                <button @click="step = 2" class="text-sm text-gray-400 font-bold">â† ì¸ì› ë‹¤ì‹œ ì„ íƒ</button>
                <div class="flex justify-between items-end">
                    <h2 class="text-2xl font-black text-gray-800">ë¹„ë”© ì„¤ì •</h2>
                </div>

                <div class="space-y-3">
                    <label class="text-xs font-black text-gray-400 uppercase tracking-widest ml-1">ì£¼ê³µ (Dealer)</label>
                    <div class="grid grid-cols-5 gap-2">
                        <button v-for="name in selectedPlayers" @click="formData.dealer = name"
                            :class="['p-3 rounded-xl border-2 text-sm font-bold transition-all break-keep', formData.dealer === name ? 'border-blue-600 bg-blue-50 text-blue-700' : 'border-gray-100 text-gray-400']">
                            {{ name }}
                        </button>
                    </div>
                </div>

                <div class="space-y-3 overflow-hidden">
                    <label class="text-xs font-black text-gray-400 uppercase tracking-widest ml-1">ë¹„ë”© ë³´ë“œ (Giru & Bid)</label>
                    
                    <div class="bg-gray-50 p-4 rounded-2xl border border-gray-200 overflow-x-auto hide-scrollbar">
                        <div class="min-w-[700px] flex flex-col gap-3">
                            <div v-for="s in suits" :key="s.name" class="flex items-center border-b border-gray-200 pb-3 last:border-0 last:pb-0">
                                
                                <div :class="['w-24 font-black text-lg text-center', s.textColor]">
                                    {{ s.symbol }} {{ s.name }}
                                </div>
                                
                                <div class="flex gap-2 ml-4">
                                    <button v-for="num in bids" :key="num"
                                        @click="formData.suit = s.name; formData.bid = num"
                                        :class="['w-12 h-12 rounded-full border-[3px] font-black transition-all flex items-center justify-center', 
                                            formData.suit === s.name && formData.bid === num 
                                                ? 'bg-gray-800 text-white border-gray-800 scale-110 shadow-lg' 
                                                : 'bg-white hover:bg-gray-100 ' + s.borderColor + ' ' + s.textColor]">
                                        {{ num }}
                                    </button>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>

                <div class="text-center p-4 bg-blue-50 text-blue-800 rounded-xl font-bold">
                    í˜„ì¬ ì„ íƒ: <span class="text-blue-600">{{ formData.suit }} {{ formData.bid }}</span>
                </div>

                <button @click="step = 4" :disabled="!formData.dealer"
                    class="w-full py-5 bg-gray-900 text-white rounded-[2rem] font-black text-lg shadow-xl disabled:bg-gray-200">
                    ê²Œì„ ì‹œì‘
                </button>
            </section>

            <section v-if="step === 4" class="space-y-6">
                <div class="bg-gray-900 p-8 rounded-[2.5rem] shadow-2xl relative text-center">
                    <div class="grid grid-cols-2 gap-4 relative z-10">
                        <div class="bg-white py-4 rounded-2xl shadow-inner flex flex-col items-center justify-center">
                            <p class="text-[10px] text-gray-400 font-bold uppercase tracking-tighter mb-1">Mighty</p>
                            <p :class="['text-4xl font-black', calculateMighty.color]">{{ calculateMighty.text }}</p>
                        </div>
                        <div class="bg-white py-4 rounded-2xl shadow-inner flex flex-col items-center justify-center">
                            <p class="text-[10px] text-gray-400 font-bold uppercase tracking-tighter mb-1">Joker Call</p>
                            <p :class="['text-4xl font-black', calculateJokerCall.color]">{{ calculateJokerCall.text }}</p>
                        </div>
                    </div>
                    <div class="mt-6 pt-6 border-t border-gray-800 text-gray-400">
                        <p class="text-sm"><span class="text-white font-bold">{{ formData.dealer }}</span> ì£¼ê³µì˜ {{ formData.suit }} {{ formData.bid }}</p>
                        <p class="text-xs mt-1">ì•¼ë‹¹ ëª©í‘œ: <span class="text-red-500 font-bold">{{ 21 - formData.bid }}ì¥</span> ì´ìƒ</p>
                    </div>
                </div>

                <div class="bg-gray-50 p-6 rounded-[2rem] border border-gray-100 flex flex-col items-center">
                    <label class="block text-xs font-black text-gray-400 mb-6 text-center uppercase tracking-wider">Opponent Score (ì•¼ë‹¹ íšë“ ì¥ìˆ˜)</label>
                    
                    <div class="flex items-center justify-center gap-8 w-full mb-6">
                        <button @click="formData.oppScore = Math.max(0, formData.oppScore - 1)" 
                                class="w-14 h-14 rounded-full bg-white shadow-sm border-2 border-gray-200 text-3xl font-black text-gray-600 active:bg-gray-100 active:scale-95 transition-all flex items-center justify-center pb-1">
                            -
                        </button>
                        
                        <span class="text-6xl font-black w-20 text-center text-gray-800">{{ formData.oppScore }}</span>
                        
                        <button @click="formData.oppScore = Math.min(20, formData.oppScore + 1)" 
                                class="w-14 h-14 rounded-full bg-white shadow-sm border-2 border-gray-200 text-3xl font-black text-gray-600 active:bg-gray-100 active:scale-95 transition-all flex items-center justify-center pb-1">
                            +
                        </button>
                    </div>

                    <div class="w-full px-2">
                        <input type="range" v-model.number="formData.oppScore" min="0" max="20" 
                               class="w-full accent-blue-600 h-3 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                        <div class="flex justify-between w-full text-xs font-bold text-gray-400 mt-3 px-1">
                            <span>0</span><span>5</span><span>10</span><span>15</span><span>20</span>
                        </div>
                    </div>
                </div>

                <div :class="['py-5 rounded-[2rem] text-center font-black transition-all border-4', isWin ? 'bg-green-50 text-green-600 border-green-200' : 'bg-red-50 text-red-600 border-red-100']">
                    {{ isWin ? 'ğŸ† ì—¬ë‹¹ ìŠ¹ë¦¬' : 'ğŸ’€ ì•¼ë‹¹ íŒŒì•¡' }}
                </div>

                <div class="flex gap-2">
                    <button @click="step = 3" class="flex-1 py-4 bg-gray-100 text-gray-500 rounded-2xl font-bold">ë¹„ë”© ìˆ˜ì •</button>
                    <button @click="sendData" :disabled="loading" class="flex-[2] py-4 bg-gray-900 text-white rounded-2xl font-black text-lg active:scale-95 transition-transform disabled:bg-gray-200">
                        {{ loading ? 'ê¸°ë¡ ì¤‘...' : 'ê²°ê³¼ ì €ì¥' }}
                    </button>
                </div>
            </section>
        </main>
    </div>

    <script>
        const { createApp } = Vue;
        createApp({
            data() {
                return {
                    step: 1,
                    playerList: [],
                    selectedPlayers: [],
                    newPlayerName: '',
                    loading: false,
                    // 1. ë…¸ê¸°ë£¨, ìŠ¤í˜ì´ë“œ, ë‹¤ì´ì•„, í´ë¡œë²„, í•˜íŠ¸ ìˆœì„œë¡œ ì •ë ¬
                    suits: [
                        { symbol: 'N', name: 'ë…¸ê¸°ë£¨', textColor: 'text-gray-400', borderColor: 'border-gray-400' },
                        { symbol: 'â™ ', name: 'ìŠ¤í˜ì´ë“œ', textColor: 'text-gray-900', borderColor: 'border-gray-900' },
                        { symbol: 'â™¦', name: 'ë‹¤ì´ì•„', textColor: 'text-red-600', borderColor: 'border-red-600' },
                        { symbol: 'â™£', name: 'í´ë¡œë²„', textColor: 'text-gray-900', borderColor: 'border-gray-900' },
                        { symbol: 'â™¥', name: 'í•˜íŠ¸', textColor: 'text-red-600', borderColor: 'border-red-600' }
                    ],
                    bids: [11, 12, 13, 14, 15, 16, 17, 18, 19, 20],
                    formData: { dealer: '', friend: 'ë…¸í”„ë Œë“œ', suit: 'ìŠ¤í˜ì´ë“œ', bid: 13, oppScore: 0, result: 'ì„±ê³µ' }
                }
            },
            computed: {
                // 2. ë§ˆì´í‹° ìƒ‰ìƒ ê°ì²´ ë°˜í™˜ ë¡œì§ ì¶”ê°€
                calculateMighty() { 
                    if (this.formData.suit === 'ìŠ¤í˜ì´ë“œ') {
                        return { text: 'â™¦ A', color: 'text-red-600' };
                    }
                    return { text: 'â™  A', color: 'text-gray-900' };
                },
                // 2. ì¡°ì»¤ì½œ ìƒ‰ìƒ ê°ì²´ ë°˜í™˜ ë¡œì§ ì¶”ê°€
                calculateJokerCall() {
                    if (this.formData.suit === 'í´ë¡œë²„') {
                        return { text: 'â™  3', color: 'text-gray-900' };
                    }
                    return { text: 'â™£ 3', color: 'text-gray-900' }; 
                },
                isWin() { return this.formData.oppScore < (21 - this.formData.bid); }
            },
            methods: {
                togglePlayer(name) {
                    const idx = this.selectedPlayers.indexOf(name);
                    if (idx > -1) this.selectedPlayers.splice(idx, 1);
                    else if (this.selectedPlayers.length < 5) this.selectedPlayers.push(name);
                },
                async fetchPlayers() {
                    try {
                        const res = await fetch(CONFIG.GAS_URL);
                        const data = await res.json();
                        this.playerList = data.players || [];
                    } catch (e) { console.error("ë°ì´í„° ë¡œë”© ì‹¤íŒ¨"); }
                },
                async addPlayer() {
                    if(!this.newPlayerName) return;
                    await fetch(CONFIG.GAS_URL, {
                        method: "POST", mode: "no-cors",
                        body: JSON.stringify({ action: "addPlayer", name: this.newPlayerName })
                    });
                    this.playerList.push(this.newPlayerName);
                    this.newPlayerName = '';
                },
                async sendData() {
                    this.loading = true;
                    this.formData.result = this.isWin ? 'ì„±ê³µ' : 'ì‹¤íŒ¨';
                    try {
                        await fetch(CONFIG.GAS_URL, {
                            method: "POST", mode: "no-cors",
                            headers: { "Content-Type": "text/plain" },
                            body: JSON.stringify(this.formData)
                        });
                        alert("âœ… ê¸°ë¡ ì™„ë£Œ!");
                        this.step = 3; 
                        this.formData.oppScore = 0;
                    } catch (e) { alert("ì €ì¥ ì‹¤íŒ¨"); } finally { this.loading = false; }
                }
            },
            mounted() { this.fetchPlayers(); }
        }).mount('#app')
    </script>
</body>
</html>