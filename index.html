<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mighty Master</title>
    <script src="config.js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #f3f4f6; -webkit-tap-highlight-color: transparent; font-family: 'Pretendard', sans-serif; overflow-y: hidden; }
        .menu-card { transition: all 0.2s; border: 1px solid #e5e7eb; }
        .menu-card:active { transform: scale(0.95); background-color: #f9fafb; }
        [v-cloak] { display: none; }
        
        /* ë¹„ë”© ë³´ë“œ ê°€ë¡œ ìŠ¤í¬ë¡¤ë°” ìˆ¨ê¸°ê¸° */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body>
    <div id="app" v-cloak class="max-w-md mx-auto h-[100dvh] bg-white shadow-xl flex flex-col overflow-hidden">
        
        <header class="bg-gray-900 text-white py-3 px-4 text-center shadow-md z-10 shrink-0">
            <h1 class="text-lg font-black italic tracking-tighter">MIGHTY MASTER</h1>
        </header>

        <main class="flex-grow p-4 flex flex-col overflow-y-auto">
            
            <section v-if="step === 1" class="flex-grow flex flex-col justify-center space-y-4">
                <div class="text-center mb-6">
                    <p class="text-gray-400 text-xs font-bold uppercase tracking-widest">Welcome back</p>
                    <h2 class="text-2xl font-black text-gray-800">ë¬´ì—‡ì„ ë„ì™€ë“œë¦´ê¹Œìš”?</h2>
                </div>
                
                <button @click="step = 2" class="menu-card w-full p-6 rounded-[1.5rem] bg-white shadow-sm flex items-center justify-between group">
                    <div class="text-left">
                        <h3 class="text-lg font-black text-gray-800">ê²Œì„ ì‹œì‘</h3>
                        <p class="text-xs text-gray-400">ì¸ì› ì„ íƒ ë° ë¹„ë”© ê¸°ë¡</p>
                    </div>
                    <span class="text-3xl">ğŸƒ</span>
                </button>

                <button @click="alert('í†µê³„ ê¸°ëŠ¥ì€ ë°ì´í„°ê°€ ìŒ“ì¸ í›„ ì˜¤í”ˆë©ë‹ˆë‹¤!')" class="menu-card w-full p-6 rounded-[1.5rem] bg-white shadow-sm flex items-center justify-between opacity-60">
                    <div class="text-left">
                        <h3 class="text-lg font-black text-gray-800">ì „ì  í†µê³„</h3>
                        <p class="text-xs text-gray-400">ELO ë­í‚¹ ë° ìŠ¹ë¥  í™•ì¸</p>
                    </div>
                    <span class="text-3xl">ğŸ“Š</span>
                </button>
            </section>

            <section v-if="step === 2" class="flex flex-col h-full space-y-4">
                <div class="flex justify-between items-center pb-2 border-b">
                    <h2 class="text-xl font-black text-gray-800">ì¸ì› ì„ íƒ</h2>
                    <span class="text-blue-600 font-black text-sm">{{ selectedPlayers.length }} / 5 ëª…</span>
                </div>
                
                <div class="grid grid-cols-2 gap-2 max-h-[40vh] overflow-y-auto p-1">
                    <button v-for="name in playerList" :key="name" 
                        @click="togglePlayer(name)"
                        :class="['p-3 rounded-xl border-2 text-sm font-bold transition-all', 
                                 selectedPlayers.includes(name) ? 'border-blue-600 bg-blue-50 text-blue-700' : 'border-gray-100 bg-white text-gray-400']">
                        {{ name }}
                    </button>
                </div>

                <div class="bg-gray-100 p-2 rounded-xl flex gap-2 shrink-0">
                    <input v-model="newPlayerName" @keyup.enter="addPlayer" class="flex-grow bg-transparent px-3 text-sm outline-none" placeholder="ì‹ ê·œ ë©¤ë²„ ì¶”ê°€...">
                    <button @click="addPlayer" class="bg-white px-3 py-2 rounded-lg text-xs font-black shadow-sm">ë“±ë¡</button>
                </div>

                <div class="mt-auto pt-2 shrink-0">
                    <button @click="step = 3" :disabled="selectedPlayers.length !== 5"
                        class="w-full py-4 bg-blue-600 text-white rounded-2xl font-black text-base shadow-lg disabled:bg-gray-200 transition-colors">
                        ì¸ì› ì„ íƒ ì™„ë£Œ
                    </button>
                </div>
            </section>

            <section v-if="step === 3" class="flex flex-col h-full space-y-3">
                <div class="flex justify-between items-center">
                    <h2 class="text-lg font-black text-gray-800">ë¹„ë”© ì„¤ì •</h2>
                    <button @click="step = 2" class="text-xs text-gray-400 font-bold bg-gray-100 px-3 py-1.5 rounded-lg active:bg-gray-200">â† ì¸ì› ë³€ê²½</button>
                </div>

                <div class="space-y-1.5 shrink-0">
                    <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">ì£¼ê³µ (Dealer)</label>
                    <div class="grid grid-cols-5 gap-1">
                        <button v-for="name in selectedPlayers" @click="formData.dealer = name"
                            :class="['p-2 rounded-lg border-2 text-xs font-bold transition-all break-keep', formData.dealer === name ? 'border-blue-600 bg-blue-50 text-blue-700' : 'border-gray-100 text-gray-400 bg-white']">
                            {{ name }}
                        </button>
                    </div>
                </div>

                <div class="space-y-1.5 flex-grow flex flex-col overflow-hidden min-h-[240px]">
                    <label class="text-[10px] font-black text-gray-400 uppercase tracking-widest ml-1">ë¹„ë”© ë³´ë“œ (Giru & Bid)</label>
                    
                    <div class="bg-gray-50 py-2 pr-2 pl-0 rounded-2xl border border-gray-200 overflow-x-auto hide-scrollbar flex-grow relative">
                        <div class="min-w-max flex flex-col gap-3 py-2">
                            <div v-for="s in suits" :key="s.name" class="flex items-center">
                                
                                <div :class="['sticky left-0 bg-gray-50 w-14 h-10 flex items-center justify-center font-black text-[28px] shrink-0 z-30 shadow-[4px_0_8px_-6px_rgba(0,0,0,0.2)]', s.textColor]">
                                    {{ s.symbol }}
                                </div>
                                
                                <div class="flex gap-3 ml-2 pr-10 relative z-0">
                                    <button v-for="num in bids" :key="num"
                                        @click="formData.suit = s.name; formData.bid = num"
                                        :class="[
                                            'w-10 h-10 rounded-full border-[3px] font-black transition-all flex shrink-0 items-center justify-center', 
                                            formData.suit === s.name && formData.bid === num 
                                                ? 'bg-gray-800 text-white border-gray-800 scale-110 shadow-md z-20' 
                                                : 'bg-white hover:bg-gray-100 ' + s.borderColor + ' ' + s.textColor,
                                            (s.name === 'ë…¸ê¸°ë£¨' || num === 20) ? 'translate-x-[26px]' : ''
                                        ]">
                                        {{ num }}
                                    </button>
                                </div>

                            </div>
                        </div>
                    </div>
                </div>

                <div class="text-center p-3 bg-blue-50 text-blue-800 rounded-xl font-bold text-sm shrink-0">
                    í˜„ì¬ ì„ íƒ: 
                    <span v-if="formData.suit && formData.bid" class="text-blue-600 text-base ml-1">
                        {{ formData.suit }} {{ formData.bid }}
                    </span>
                    <span v-else class="text-gray-400 text-xs ml-1 font-normal">
                        ë¬¸ì–‘ê³¼ ìˆ«ìë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”
                    </span>
                </div>

                <div class="shrink-0 pt-1">
                    <button @click="step = 4" :disabled="!formData.dealer || !formData.suit || !formData.bid"
                        class="w-full py-4 bg-gray-900 text-white rounded-[1.5rem] font-black text-base shadow-lg disabled:bg-gray-200 disabled:text-gray-400 transition-colors">
                        ê²Œì„ ì‹œì‘
                    </button>
                </div>
            </section>

            <section v-if="step === 4" class="flex flex-col h-full space-y-4">
                
                <div class="bg-gray-900 p-5 rounded-3xl shadow-xl relative text-center shrink-0">
                    <div class="grid grid-cols-2 gap-3 relative z-10">
                        <div class="bg-white py-3 rounded-xl shadow-inner flex flex-col items-center justify-center">
                            <p class="text-[10px] text-gray-400 font-bold uppercase tracking-tighter mb-0.5">Mighty</p>
                            <p :class="['text-2xl font-black', calculateMighty.color]">{{ calculateMighty.text }}</p>
                        </div>
                        <div class="bg-white py-3 rounded-xl shadow-inner flex flex-col items-center justify-center">
                            <p class="text-[10px] text-gray-400 font-bold uppercase tracking-tighter mb-0.5">Joker Call</p>
                            <p :class="['text-2xl font-black', calculateJokerCall.color]">{{ calculateJokerCall.text }}</p>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t border-gray-800 text-gray-400">
                        <p class="text-sm"><span class="text-white font-bold">{{ formData.dealer }}</span> ì£¼ê³µì˜ {{ formData.suit }} {{ formData.bid }}</p>
                        <p class="text-xs mt-1">ì•¼ë‹¹ ëª©í‘œ: <span class="text-red-500 font-bold">{{ 21 - formData.bid }}ì¥</span> ì´ìƒ</p>
                    </div>
                </div>

                <div class="bg-gray-50 p-4 rounded-3xl border border-gray-100 flex flex-col items-center shrink-0">
                    <label class="block text-[10px] font-black text-gray-400 mb-4 text-center uppercase tracking-wider">Opponent Score (ì•¼ë‹¹ íšë“ ì¥ìˆ˜)</label>
                    
                    <div class="flex items-center justify-center gap-6 w-full mb-4">
                        <button @click="formData.oppScore = Math.max(0, formData.oppScore - 1)" 
                                class="w-12 h-12 rounded-full bg-white shadow-sm border border-gray-200 text-2xl font-black text-gray-600 active:bg-gray-100 active:scale-95 transition-all flex items-center justify-center pb-1">
                            -
                        </button>
                        
                        <span class="text-5xl font-black w-16 text-center text-gray-800">{{ formData.oppScore }}</span>
                        
                        <button @click="formData.oppScore = Math.min(20, formData.oppScore + 1)" 
                                class="w-12 h-12 rounded-full bg-white shadow-sm border border-gray-200 text-2xl font-black text-gray-600 active:bg-gray-100 active:scale-95 transition-all flex items-center justify-center pb-1">
                            +
                        </button>
                    </div>

                    <div class="w-full px-2">
                        <input type="range" v-model.number="formData.oppScore" min="0" max="20" 
                               class="w-full accent-blue-600 h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                    </div>
                </div>

                <div :class="['py-3 rounded-2xl text-center font-black transition-all border-2 shrink-0', isWin ? 'bg-green-50 text-green-600 border-green-200' : 'bg-red-50 text-red-600 border-red-100']">
                    {{ isWin ? 'ğŸ† ì—¬ë‹¹ ìŠ¹ë¦¬' : 'ğŸ’€ ì•¼ë‹¹ íŒŒì•¡' }}
                </div>

                <div class="flex gap-2 mt-auto shrink-0 pt-2">
                    <button @click="step = 3" class="flex-1 py-3 bg-gray-100 text-gray-500 rounded-2xl font-bold text-sm">ë¹„ë”© ìˆ˜ì •</button>
                    <button @click="sendData" :disabled="loading" class="flex-[2] py-3 bg-gray-900 text-white rounded-2xl font-black text-base active:scale-95 transition-transform disabled:bg-gray-200">
                        {{ loading ? 'ê¸°ë¡ ì¤‘...' : 'ê²°ê³¼ ì €ì¥' }}
                    </button>
                </div>
            </section>
        </main>
    </div>

    <script>
        const { createApp } = Vue;
        createApp({
            data() {
                return {
                    step: 1,
                    playerList: [],
                    selectedPlayers: [],
                    newPlayerName: '',
                    loading: false,
                    suits: [
                        { symbol: 'N', name: 'ë…¸ê¸°ë£¨', textColor: 'text-gray-400', borderColor: 'border-gray-400' },
                        { symbol: 'â™ ', name: 'ìŠ¤í˜ì´ë“œ', textColor: 'text-gray-900', borderColor: 'border-gray-900' },
                        { symbol: 'â™¦', name: 'ë‹¤ì´ì•„', textColor: 'text-red-600', borderColor: 'border-red-600' },
                        { symbol: 'â™£', name: 'í´ë¡œë²„', textColor: 'text-gray-900', borderColor: 'border-gray-900' },
                        { symbol: 'â™¥', name: 'í•˜íŠ¸', textColor: 'text-red-600', borderColor: 'border-red-600' }
                    ],
                    bids: [11, 12, 13, 14, 15, 16, 17, 18, 19, 20],
                    formData: { dealer: '', friend: 'ë…¸í”„ë Œë“œ', suit: null, bid: null, oppScore: 0, result: '' }
                }
            },
            computed: {
                calculateMighty() { 
                    if (!this.formData.suit) return { text: '-', color: 'text-gray-400' };
                    if (this.formData.suit === 'ìŠ¤í˜ì´ë“œ') return { text: 'â™¦ A', color: 'text-red-600' };
                    return { text: 'â™  A', color: 'text-gray-900' };
                },
                calculateJokerCall() {
                    if (!this.formData.suit) return { text: '-', color: 'text-gray-400' };
                    if (this.formData.suit === 'í´ë¡œë²„') return { text: 'â™  3', color: 'text-gray-900' };
                    return { text: 'â™£ 3', color: 'text-gray-900' }; 
                },
                isWin() { 
                    if (!this.formData.bid) return false;
                    return this.formData.oppScore < (21 - this.formData.bid); 
                }
            },
            methods: {
                togglePlayer(name) {
                    const idx = this.selectedPlayers.indexOf(name);
                    if (idx > -1) this.selectedPlayers.splice(idx, 1);
                    else if (this.selectedPlayers.length < 5) this.selectedPlayers.push(name);
                },
                async fetchPlayers() {
                    try {
                        const res = await fetch(CONFIG.GAS_URL);
                        const data = await res.json();
                        this.playerList = data.players || [];
                    } catch (e) { console.error("ë°ì´í„° ë¡œë”© ì‹¤íŒ¨"); }
                },
                async addPlayer() {
                    if(!this.newPlayerName) return;
                    await fetch(CONFIG.GAS_URL, {
                        method: "POST", mode: "no-cors",
                        body: JSON.stringify({ action: "addPlayer", name: this.newPlayerName })
                    });
                    this.playerList.push(this.newPlayerName);
                    this.newPlayerName = '';
                },
                async sendData() {
                    this.loading = true;
                    this.formData.result = this.isWin ? 'ì„±ê³µ' : 'ì‹¤íŒ¨';
                    try {
                        await fetch(CONFIG.GAS_URL, {
                            method: "POST", mode: "no-cors",
                            headers: { "Content-Type": "text/plain" },
                            body: JSON.stringify(this.formData)
                        });
                        alert("âœ… ê¸°ë¡ ì™„ë£Œ!");
                        
                        this.step = 3; 
                        this.formData.oppScore = 0;
                        this.formData.suit = null;
                        this.formData.bid = null;
                        this.formData.dealer = ''; 
                        
                    } catch (e) { alert("ì €ì¥ ì‹¤íŒ¨"); } finally { this.loading = false; }
                }
            },
            mounted() { this.fetchPlayers(); }
        }).mount('#app')
    </script>
</body>
</html>