<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Mighty Master</title>
    <script src="config.js"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { background-color: #f3f4f6; -webkit-tap-highlight-color: transparent; }
        .input-focus:focus { border-color: #3b82f6; outline: none; box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1); }
        [v-cloak] { display: none; }
    </style>
</head>
<body>
    <div id="app" v-cloak class="max-w-md mx-auto min-h-screen bg-white shadow-xl flex flex-col font-sans">
        <header class="bg-gray-900 text-white py-6 px-4 text-center shadow-md">
            <h1 class="text-xl font-black tracking-tighter italic">ğŸƒ MIGHTY MASTER</h1>
            <p class="text-[10px] text-gray-400 mt-1 uppercase tracking-widest">Assistant & Tracker</p>
        </header>

        <main class="flex-grow p-5 space-y-8">
            <section class="space-y-4">
                <div class="flex justify-between items-end">
                    <h2 class="text-sm font-black text-gray-400 uppercase">1. Players</h2>
                    <span class="text-[10px] text-blue-500 font-bold">ì¸ì› ê´€ë¦¬ ê°€ëŠ¥</span>
                </div>
                
                <div class="grid grid-cols-2 gap-4">
                    <div class="space-y-1">
                        <label class="text-[11px] font-bold text-gray-500 ml-1">ì£¼ê³µ (Dealer)</label>
                        <select v-model="formData.dealer" class="w-full border-2 border-gray-100 p-3 rounded-xl bg-gray-50 text-sm font-bold input-focus">
                            <option value="">ì„ íƒí•˜ì„¸ìš”</option>
                            <option v-for="name in playerList" :key="name" :value="name">{{ name }}</option>
                        </select>
                    </div>
                    <div class="space-y-1">
                        <label class="text-[11px] font-bold text-gray-500 ml-1">í”„ë Œë“œ (Friend)</label>
                        <select v-model="formData.friend" class="w-full border-2 border-gray-100 p-3 rounded-xl bg-gray-50 text-sm font-bold input-focus">
                            <option value="ë…¸í”„ë Œë“œ">ë…¸í”„ë Œë“œ</option>
                            <option v-for="name in playerList" :key="name" :value="name">{{ name }}</option>
                        </select>
                    </div>
                </div>

                <div class="flex gap-2 p-2 bg-gray-50 rounded-2xl border border-gray-100">
                    <input v-model="newPlayerName" @keyup.enter="addPlayer" class="flex-grow bg-transparent px-3 py-2 text-sm outline-none" placeholder="ìƒˆ ë©¤ë²„ ì´ë¦„ ì…ë ¥...">
                    <button @click="addPlayer" class="bg-white px-4 py-2 rounded-xl text-xs font-black shadow-sm active:scale-95 transition-transform border border-gray-200">ë“±ë¡</button>
                </div>
            </section>

            <section class="space-y-3">
                <h2 class="text-sm font-black text-gray-400 uppercase">2. Trump Suit</h2>
                <div class="flex justify-between gap-1">
                    <button v-for="s in suits" :key="s.name" @click="formData.suit = s.name"
                        :class="['flex-1 py-3 rounded-xl text-xs font-black border transition-all', 
                                formData.suit === s.name ? 'bg-blue-600 text-white border-blue-600 shadow-lg shadow-blue-200 -translate-y-1' : 'bg-white text-gray-400 border-gray-100']">
                        {{ s.name }}
                    </button>
                </div>
            </section>

            <section class="bg-gray-900 p-6 rounded-[2rem] shadow-2xl relative overflow-hidden">
                <div class="absolute top-0 right-0 p-4 opacity-10">
                    <span class="text-4xl text-white font-black italic">GUIDE</span>
                </div>
                <div class="grid grid-cols-3 gap-4 relative z-10 text-center">
                    <div class="space-y-1">
                        <p class="text-[9px] text-blue-400 font-bold uppercase tracking-tighter">Mighty</p>
                        <p class="text-lg font-black text-white">{{ calculateMighty }}</p>
                    </div>
                    <div class="space-y-1 border-x border-gray-800">
                        <p class="text-[9px] text-blue-400 font-bold uppercase tracking-tighter">Joker Call</p>
                        <p class="text-lg font-black text-white">{{ calculateJokerCall }}</p>
                    </div>
                    <div class="space-y-1">
                        <p class="text-[9px] text-blue-400 font-bold uppercase tracking-tighter">Opp. Target</p>
                        <p class="text-lg font-black text-white">{{ 21 - formData.bid }}ì¥</p>
                    </div>
                </div>
            </section>

            <section class="space-y-4 pt-2">
                <h2 class="text-sm font-black text-gray-400 uppercase">3. Game Result</h2>
                <div class="bg-gray-50 p-5 rounded-[2rem] border border-gray-100 space-y-6">
                    <div>
                        <div class="flex justify-between items-center mb-4">
                            <span class="text-xs font-black">ë¹„ë”© (Bidding)</span>
                            <span class="text-2xl font-black text-blue-600">{{ formData.bid }}</span>
                        </div>
                        <input type="range" v-model.number="formData.bid" min="13" max="20" class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer accent-blue-600">
                    </div>
                    <div>
                        <label class="text-xs font-black block mb-2">ì•¼ë‹¹ íšë“ ì ìˆ˜</label>
                        <input type="number" v-model.number="formData.oppScore" class="w-full bg-white border-2 border-gray-100 p-4 rounded-2xl text-lg font-bold input-focus" placeholder="0">
                    </div>
                </div>

                <div :class="['py-5 rounded-[2rem] text-center font-black text-sm border-4 transition-all duration-500', 
                             isWin ? 'bg-green-50 text-green-600 border-green-100' : 'bg-red-50 text-red-600 border-red-100']">
                    {{ isWin ? 'ğŸ† ì—¬ë‹¹ ìŠ¹ë¦¬ (ì„±ê³µ)' : 'ğŸ’€ ì•¼ë‹¹ ìŠ¹ë¦¬ (íŒŒì•¡)' }}
                </div>
            </section>
        </main>

        <footer class="p-5 bg-white border-t border-gray-50 sticky bottom-0">
            <button @click="sendData" :disabled="loading || !formData.dealer" 
                class="w-full py-5 bg-gray-900 text-white rounded-[2rem] font-black text-lg shadow-xl active:scale-95 transition-transform disabled:bg-gray-200 disabled:text-gray-400">
                {{ loading ? 'ë°ì´í„° ì „ì†¡ ì¤‘...' : 'ê¸°ë¡ ì™„ë£Œ ë° ì €ì¥' }}
            </button>
            <transition name="fade">
                <p v-if="statusMsg" class="text-center mt-4 text-xs font-bold text-blue-600">{{ statusMsg }}</p>
            </transition>
        </footer>
    </div>

    <script>
        const { createApp } = Vue;
        createApp({
            data() {
                return {
                    playerList: [],
                    newPlayerName: '',
                    loading: false,
                    statusMsg: '',
                    suits: [{name:'ìŠ¤í˜ì´ë“œ'}, {name:'í•˜íŠ¸'}, {name:'ë‹¤ì´ì•„'}, {name:'í´ë¡œë²„'}, {name:'ë…¸ê¸°ë£¨'}],
                    formData: {
                        dealer: '',
                        friend: 'ë…¸í”„ë Œë“œ',
                        suit: 'ìŠ¤í˜ì´ë“œ',
                        bid: 13,
                        oppScore: 0,
                        result: 'ì„±ê³µ'
                    }
                }
            },
            computed: {
                calculateMighty() {
                    return this.formData.suit === 'ìŠ¤í˜ì´ë“œ' ? 'â™¦ A' : 'â™  A';
                },
                calculateJokerCall() {
                    if (this.formData.suit === 'ë…¸ê¸°ë£¨') return 'ì—†ìŒ';
                    const icons = {'ìŠ¤í˜ì´ë“œ':'â™ ','í•˜íŠ¸':'â™¥','ë‹¤ì´ì•„':'â™¦','í´ë¡œë²„':'â™£'};
                    return (icons[this.formData.suit] || '') + ' 3';
                },
                isWin() {
                    const target = 21 - this.formData.bid;
                    return this.formData.oppScore < target;
                }
            },
            methods: {
                async fetchPlayers() {
                    try {
                        const res = await fetch(CONFIG.GAS_URL);
                        const data = await res.json();
                        this.playerList = data.players || [];
                    } catch (e) {
                        this.statusMsg = "ë©¤ë²„ ë¡œë”© ì‹¤íŒ¨";
                    }
                },
                async addPlayer() {
                    if(!this.newPlayerName) return;
                    this.statusMsg = "ë©¤ë²„ ë“±ë¡ ì¤‘...";
                    try {
                        await fetch(CONFIG.GAS_URL, {
                            method: "POST",
                            mode: "no-cors",
                            body: JSON.stringify({ action: "addPlayer", name: this.newPlayerName })
                        });
                        this.playerList.push(this.newPlayerName);
                        this.newPlayerName = '';
                        this.statusMsg = "ë“±ë¡ ìš”ì²­ ì™„ë£Œ!";
                        setTimeout(() => { this.statusMsg = ''; }, 2000);
                    } catch (e) {
                        this.statusMsg = "ë“±ë¡ ì‹¤íŒ¨";
                    }
                },
                async sendData() {
                    this.loading = true;
                    this.statusMsg = "ì €ì¥ ì¤‘ì…ë‹ˆë‹¤...";
                    this.formData.result = this.isWin ? 'ì„±ê³µ' : 'ì‹¤íŒ¨';
                    
                    try {
                        await fetch(CONFIG.GAS_URL, {
                            method: "POST",
                            mode: "no-cors",
                            headers: { "Content-Type": "text/plain" },
                            body: JSON.stringify(this.formData)
                        });
                        this.statusMsg = "âœ… ê¸°ë¡ ì„±ê³µ! ì‹œíŠ¸ë¥¼ í™•ì¸í•˜ì„¸ìš”.";
                        this.formData.oppScore = 0;
                        setTimeout(() => { this.statusMsg = ''; }, 3000);
                    } catch (e) {
                        this.statusMsg = "âŒ ì˜¤ë¥˜: " + e.message;
                    } finally {
                        this.loading = false;
                    }
                }
            },
            mounted() {
                this.fetchPlayers();
            }
        }).mount('#app')
    </script>
</body>
</html>